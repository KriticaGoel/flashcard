<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Custom Exceptional Handling — Spring Boot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS for layout -->
  <link
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
          rel="stylesheet">

  <!-- Prism CSS for code highlighting -->
  <link
          href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css"
          rel="stylesheet">

  <style>
    body {
      background-color: #f8f9fa;
      color: #343a40;
      font-family: 'Inter', sans-serif;
    }
    header {
      padding: 2rem 0;
      text-align: center;
      background: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    header h1 {
      font-weight: 600;
      margin-bottom: 0.2rem;
    }
    header p {
      color: #6c757d;
    }
    .section-title {
      margin-top: 2rem;
      margin-bottom: 1rem;
      border-bottom: 2px solid #dee2e6;
      padding-bottom: .3rem;
      color: #495057;
    }
    .note-box {
      background-color: #e9f7fe;
      border-left: .25rem solid #0d6efd;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: .25rem;
    }
    pre[class*=language-] {
      background: #50514c;
    }
    pre {
      margin-bottom: 1.5rem;
      border-radius: .3rem;
    }
  </style>
</head>
<body>

<header>
  <div class="container">
    <h1>Custom Exceptional Handling</h1>
    <p>Centralized exception management in Spring Boot</p>
  </div>
</header>

<main class="container my-4">
    <p>
    The @RestControllerAdvice with @ExceptionHandler automatically catches and handles exceptions thrown by any controller in your Spring application

    @RestControllerAdvice - this is a class level annotation
    @ExceptionHandler - this is a method level annotation having class as an argument
    </p>
    <img
            src="/images/contollerAdvicer.PNG"
            alt="Controller Advice Diagram"
            class="img-fluid"
            style="max-width:100%; height:auto;">



    <h2 class="section-title"> Step  1. Create a DTO</h2>
  <pre><code class="language-java">
    @Data
    public class ProductNotFoundExceptionDto {

        private String message;
        private String resolution;
    }
  </code></pre>
  <!-- 2. Custom Exception Class -->
  <h2 class="section-title">Step 2. Custom Exception Class</h2>
  <p>Create a <code>RuntimeException</code> subclass to carry your own fields.</p>
  <pre><code class="language-java">
    public class ProductNotFoundException extends Exception {
      public ProductNotFoundException(String message) {
          super(message);
      }
    }
  </code></pre>
  <!-- 1. Global Exception Handler -->
  <h2 class="section-title">Step 3. Defining in Global Exception Handler</h2>
  <p>
    Annotate a class with <code>@RestControllerAdvice</code> and methods with
    <code>@ExceptionHandler</code> to catch exceptions from any controller.
  </p>

  <pre><code class="language-java">
@RestControllerAdvice
public class GlobalException {

    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity&lt;Map&lt;String, String&gt;&gt; handleValidation(
            MethodArgumentNotValidException e) {

        Map&lt;String, String&gt; errors = new HashMap&lt;&gt;();
        e.getBindingResult().getAllErrors().forEach(error -&gt; {
            String field = ((FieldError) error).getField();
            String msg   = error.getDefaultMessage();
            errors.put(field, msg);
        });

        return new ResponseEntity&lt;&gt;(errors, HttpStatus.BAD_REQUEST);
    }

    @ExceptionHandler(ProductNotFoundException.class)
    public ResponseEntity&lt;ProductNotFoundExceptionDto&gt; handleProductNotFound(
            ProductNotFoundException ex) {

        ProductNotFoundExceptionDto dto = new ProductNotFoundExceptionDto();
        dto.setMessage("Product not found");
        dto.setResolution("Use a valid product ID");

        return ResponseEntity
                .status(HttpStatus.NOT_FOUND)
                .body(dto);
    }
}
  </code></pre>
  <!-- 3. Throwing the Exception -->
  <h2 class="section-title">4. Throwing the Exception</h2>
  <p>Use <code>orElseThrow</code> from your service layer:</p>

  <pre><code class="language-java">
Category cat = categories.stream()
    .filter(c -&gt; c.getId().equals(id))
    .findFirst()
    .orElseThrow(() -&gt;
        new ResourcesNotFound("Category", id, "invalid ID"));
    </code></pre>

  <!-- 4. Levels of Handling -->
  <h2 class="section-title">4. Levels of Exception Handling</h2>
  <ol>
    <li><strong>Try/Catch Block</strong> inside methods.</li>
    <li><strong>Controller-Level</strong> with <code>@ExceptionHandler</code>.</li>
    <li><strong>Global Advice</strong> with <code>@RestControllerAdvice</code>.</li>
  </ol>

  <div class="note-box">
    <strong>Order of Precedence:</strong><br>
    1) Try/Catch → 2) Controller-Level → 3) Global Advice
  </div>

  <!-- 5. Centralizing Messages -->
  <h2 class="section-title">5. Centralizing Messages</h2>
    <p>Use Constants or Enum for Messages Define your messages in a central place, like a constants class or an enum</p>
  <h5>a) Constants / Enums</h5>
  <pre><code class="language-java">
public class ErrorMessages {
    public static final String USER_NOT_FOUND = "User not found";
    // more messages...
}
    </code></pre>
  <p>Then throw:</p>
  <pre><code class="language-java">
throw new ResourceNotFoundException(
    ErrorMessages.USER_NOT_FOUND);
    </code></pre>

  <h5>b) Internationalization (i18n)</h5>
  <p>Inject <code>MessageSource</code> to fetch localized messages:</p>
    <p>Use Message Source for Internationalization If your app requires i18n, inject Spring’s MessageSource in your service or controller and fetch messages by key:</p>
  <pre><code class="language-java">
@Service
public class UserService {

    @Autowired
    private MessageSource messageSource;

    public User getUserById(Long id, Locale locale) {
        return userRepository.findById(id)
            .orElseThrow(() -&gt;
                new ResourceNotFoundException(
                  messageSource.getMessage(
                    "error.user.notfound", null, locale)
                )
            );
    }
}
    </code></pre>

  <div class="note-box">
    <strong>messages.properties:</strong><br>
    error.user.notfound=User not found
  </div>

    <h2 class="section-title">Best Practise</h2>
    <p>Use Service Layer for throwing exceptions and ControllerAdvice for handling them.</p>
    <img
            src="/images/ExceptionhandlerBest.PNG"
            alt="Controller Advice Diagram"
            class="img-fluid"
            style="max-width:100%; height:auto;">
</main>

<!-- Prism.js for syntax highlighting -->
<script
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js">
</script>

<!-- Bootstrap JS (optional) -->
<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js">
</script>
</body>
</html>
